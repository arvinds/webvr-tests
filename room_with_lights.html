<html>
  <head>
    <script src="https://aframe.io/releases/0.4.0/aframe.min.js"></script>
  </head>
  <body>
    <a-scene id='scene'>
      <a-assets>
        <img id="wall" src="data:image/jpeg;base64,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">
      </a-assets>
      <a-sky color="#9bc1ff" />
    </a-scene>
    <script>
      const MIN_DIMENSION_VALUE = 3;
      const MAX_HEIGHT = 8;
      const MAX_WIDTH = 13;
      const MAX_DEPTH = 13;
      function setupScene() {
        const scene = document.getElementById('scene');
        const numLights = 10;
        const lightIntensity = 20.0;
        if (document.getElementById('room')) {
          setupsides(randomFloat(MAX_HEIGHT), randomFloat(MAX_WIDTH), randomFloat(MAX_DEPTH));
        } else {
          drawRoom(scene);
        }
        setupLighting(scene, numLights, lightIntensity);
      };
      function getWallPositions(roomHeight, roomWidth, roomDepth) {
        return {
          front: `0 ${roomHeight/2} -${roomDepth/2}`,
          left: `-${roomWidth/2} ${roomHeight/2} 0`,
          right: `${roomWidth/2} ${roomHeight/2} 0`,
          back: `0 ${roomHeight/2} ${roomDepth/2}`
        };
      };
      function drawRoom(scene) {
        const room = el('a-entity', {position: '0 0 0', id: 'room'});
        const front = el('a-plane', {id: 'front'});
        const back = el('a-plane', {id: 'back'});
        const left = el('a-plane', {id: 'left'});
        const right = el('a-plane', {id: 'right'});
        const sides = {front: front, left: left, back: back, right: right};
        setupsides(MAX_HEIGHT, MAX_WIDTH, MAX_DEPTH, sides)
        addChildren(room, [front, left, back, right]);
        addChildren(scene, [room]);
      };

      function setupsides(roomHeight, roomWidth, roomDepth, sides = {}) {
          const wallPositions = getWallPositions(roomHeight, roomWidth, roomDepth);
          ['front','left','back','right'].forEach((sideId) => {
            let wallWidth = roomWidth;
            let rotation = '0 0 0';
            if (sideId == 'left' || sideId == 'right') {
               rotation = '0 90 0';
              wallWidth = roomDepth;
            }
            let wall = sides[sideId];
            if (!wall) {
              wall = document.getElementById(sideId);
            }
            setAttributes(wall, {
              height: roomHeight,
              width: wallWidth,
              position: wallPositions[sideId],
              rotation: rotation,
              material: `src: #wall; side: double; repeat: ${wallWidth/3} ${roomHeight/3}`
            });
          });
      }

      function setupLighting(scene, numLights, lightIntensity) {
      };

      function el(elName, attrs) {
        const el = document.createElement(elName);
        setAttributes(el, attrs);
        return el;
      };

      function setAttributes(el, attrs) {
        for(var key in attrs) {
          el.setAttribute(key, attrs[key]);
        }
      }

      function addChildren(parent, children) {
        for(const child of children) {
          parent.appendChild(child);
        }
      };

      function randomFloat(magnitude) {
        return Math.random() * (magnitude + MIN_DIMENSION_VALUE) + MIN_DIMENSION_VALUE;
      };
      setupScene();
      setInterval(setupScene, 2500);
    </script>
  </body>
</html>
